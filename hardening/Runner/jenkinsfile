pipeline {
    agent any

    environment {
        NODE_IP = "192.168.68.61"
    }

    stages {
        stage("Update OS") {
            steps {
                script {
                    sh 'ssh -o StrictHostKeyChecking=no root@${NODE_IP} "yum update -y"'
                }
            }
         }

        stage("Install docker") {
            steps {

                sh '''
                    ssh -o StrictHostKeyChecking=no root@${NODE_IP} << EOF
                    yum install docker -y 
                    systemctl enable docker
                    systemctl start docker
                    EOF
                    '''
            }
        }

        stage("Install kubectl") {
            steps {

                sh '''
                    ssh -o StrictHostKeyChecking=no root@${NODE_IP} << EOF
                    curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
                    chmod +x kubectl
                    mv kubectl /usr/local/bin/
                    kubectl version --client
                    EOF
                '''            
                }
        }

        stage("Install kind") {
            steps {

                sh '''
                    ssh -o StrictHostKeyChecking=no root@${NODE_IP} << EOF
                    curl -Lo ./kind https://kind.sigs.k8s.io/dl/latest/kind-linux-amd64
                    chmod +x ./kind
                    mv ./kind /usr/local/bin/
                    kind version
                    EOF
                '''
            }
        }

        post {
            always {
                echo 'Cleaning up workspace...'
                cleanWs()
            }
        }
    }
}